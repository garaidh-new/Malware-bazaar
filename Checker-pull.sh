#!/bin/bash



echo 'We assume you have all your malware in ./malware, which is /home/ec2-user/malware'

export MALWARE_PATH=/home/ec2-user/malware

if  [ $(pwd) != '/home/ec2-user' ] ; then cd /home/ec2-user ; fi

rm -rf virtualenv

python3 -m venv /home/ec2-user/virtualenv
source /home/ec2-user/virtualenv/bin/activate

pip install --upgrade pip

pip install -r /home/ec2-user/Malware-bazaar/requirements.txt

#clear up the destination bucket
aws s3 rm --recursive s3://adx-pull-gary-jul-21


# Create sha256sums and save to file
find malware/ -type f -exec sha256sum '{}' \; > malware.sha256sum


# scan it and create a report
clamscan -r -d /var/lib/clamav/ malware/ | tee clamav.report


# these IDs are hard coded coz I'm lazy
python Malware-bazaar/Create_job.py 5b3871fc2628e6bda39b02bc11088556 adx-pull-gary-jul-21 | tee /home/ec2-user/Upload.txt