#!/bin/bash

## On the producer side
# Clean up the bucket
aws s3 rm --recursive s3://adx-text-gary-jul-21/

# scan it and create a report
clamscan -r -d /var/lib/clamav/ malware/ | tee malware/clamav.report

# Create sha256sums and save to file
find malware/ -type f -exec sha256sum '{}' \; > malware/malware.sha256sum

# Sync up to S3 bucket
aws s3 sync   --no-guess-mime-type --content-type 'application/octet-stream' malware/ s3://adx-text-gary-jul-21/
exit

